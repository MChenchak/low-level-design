Общую идею удалось реализовать правильно, в соответствии с эталонным решением.
Упустил только конструкторы в конкретных реализациях